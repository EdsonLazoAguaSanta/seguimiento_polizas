{% extends "base.html" %}
{% block title %}Bancos{% endblock %}

{% block content %}
<div class="container mt-4">
  <h1 class="mb-3">Bancos</h1>
  <p class="text-muted">Origen: SharePoint: {{ ruta_polizas }}</p>

  {% if mensaje %}
    <div class="alert alert-warning">{{ mensaje }}</div>
  {% endif %}

  <h2 class="h4 mt-4 mb-3">Seleccionar pólizas con banco beneficiario</h2>
  {% if carpetas %}
    <form method="post" action="/bancos">
      <input type="hidden" name="origen" value="polizas">
      {% for carpeta, archivos in carpetas.items() %}
        <details class="mb-2">
          <summary>{{ carpeta }} ({{ archivos|length }})</summary>
          <ul class="mt-2">
            {% for doc in archivos %}
              <li>
                <label>
                  <input type="checkbox" name="seleccion" value="{{ doc.nombre }}">
                  {{ doc.nombre }}
                </label>
              </li>
            {% endfor %}
          </ul>
        </details>
      {% endfor %}
      <button type="submit" class="btn btn-primary mt-2">
        Guardar selección de pólizas
      </button>
    </form>
  {% else %}
    <div class="alert alert-info">No hay pólizas para mostrar.</div>
  {% endif %}

  <h2 class="h4 mt-5 mb-3">Correos en carpeta Bancos</h2>
  {% if mails_bancos %}
    <form method="post" action="/bancos">
      <input type="hidden" name="origen" value="mails">
      {% for mail in mails_bancos %}
        <div class="mb-2 border rounded p-2">
          <div><strong>{{ mail.asunto }}</strong></div>
          <div class="text-muted">
            {{ mail.remitente }} – {{ mail.fecha }}
          </div>
          <div class="mt-2">
            <label>Subcarpeta pólizas:</label>
            <select name="mailcarpeta">
                        <option value="">-- sin asignar --</option>
              {% for sub in subcarpetas_polizas %}
                <option value="{{ sub }}">{{ sub }}</option>
              {% endfor %}
            </select>
            <input type="hidden" name="mailid" value="{{ mail.id }}">
          </div>
        </div>
      {% endfor %}
      <button type="submit" class="btn btn-success mt-2">
        Guardar asignaciones
      </button>
    </form>
  {% else %}
    <div class="alert alert-info">
      No se encontraron correos en la carpeta Bancos.
    </div>
  {% endif %}
</div>
{% endblock %}


